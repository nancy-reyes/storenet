{% extends 'base.html' %}

{% block title %}Post a memo{% endblock %}

{% block body %}

<p>Greetings, almighty admin. You have the highest security clearance on this
    amazing web app. Cheers!</p>

<h3>What do you have to say?</h3> <!--hide this-->

<form action='/preview-post' method='post' id='post-stuff-box'>
    <div id='form-inputs'>
        Title: <input id='title-input' type='text' name='title' required value='{{ fake_title }}'><br>
    Post Category:
    <select name='category'>
        {% for category in categories: %}
        <option value='{{ category.cat_id }}'>{{ category.name }}
        </option>
        {% endfor %}
    </select>
    <button id='post-all'>Select All Stores</button>
    Send to: {# put this in a for loop #}
    <button id='post-d01' name='audience' value='D01'> District 1</button>
    <button id='post-d02' name='audience' value='D02'> District 2</button>
    <button id='post-d03' name='audience' value='D03'> District 3</button>
    <button id='post-d04' name='audience' value='D04'> District 4</button>
    <button id='post-d05' name='audience' value='D05'> District 5</button>
    <br>
    Or select a store:
    {% for store in stores %}
        <input type='checkbox' class='store' name='audience' value='{{ store.store_id }}'>{{ store.store_id }} {{ store.name }}<br>
    {% endfor %}
    <br>
    <input type='file' name='file'>
    Task required? <input id='task-required-checkbox' type='checkbox' name='has_task'>

    <div id='task-assign-section' hidden>
    Task item: <input id='task-desc-input' class='text-input' type='text/css' name='task_item' value='{{ fake_title }}'>
    Deadline: <input id='task-deadline-input' type='date' name='deadline'><br>
    </div>

    <textarea id='post-content' name='post-content' rows='10' cols='50' required>{{ fake_text }}</textarea><br>
    </div>
    <div id='post-preview' hidden></div>
    <button id='post-preview-button'>Preview Post</button>
    <button id='edit-post-button' hidden>Edit Post</button>
    <input id='post-stuff' type='submit' value="POST!">

</form>
<div id='preview-post'></div>

<script type="text/javascript">
    "use strict";

function previewPost() {
    let postTitle = $('#title-input').val();
    let postText = $('#post-content').val();
    console.log(postTitle);
    console.log(postText);
};

// Preview post stuff
$('#post-preview-button').on('click', function (evt) {
    evt.preventDefault();
    $('#edit-post-button').show();
    $('#post-preview-button').hide();
    $('#form-inputs').hide();
    $('#post-preview').html('');
    let postTitle = $('#title-input').val()
    let postText = $('#post-content').val();
    let previewTitle = $('<h4>');
    previewTitle.html(postTitle);
    $('#post-preview').append(previewTitle);
    let previewText = $('<p>');
    previewText.html(postText);
    $('#post-preview').append(previewText);
    $('#post-preview').show();
});

// Edit if post preview isn't good
$('#edit-post-button').on('click', function (evt) {
    evt.preventDefault();
    $('#post-preview').hide();
    $('#form-inputs').show();
    $('#edit-post-button').hide();
    $('#post-preview-button').show();
 
});

// Make task assignment section appear when 'task required' is checked
$('#task-required-checkbox').click(function () {
    if (this.checked) {
        $('#task-assign-section').show();
    } else {
        $('#task-assign-section').hide();
    }
});

// Select all store checkboxes
$('#post-all').on('click', function (evt) {
    evt.preventDefault();
    if ($('#post-all').html() === 'Uncheck All Stores') {
        $(':checked').removeAttr('checked');
        $('#post-all').html('Select All Stores');
    } else if ($('#post-all').html() === 'Select All Stores') {
        $('.store').attr('checked', true);
        $('#post-all').html('Uncheck All Stores');
    }
});

</script>

{% endblock %}