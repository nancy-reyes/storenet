{% extends 'base.html' %}

{% block title %}Storenet | View Store {% endblock %}

{% block body %}
<br>

<div class="col-xs-12 col-md-12 col-lg-12">
  <div class='card'><div class='card-body'>
    <b>Today's Weather</b><br>
    <img src="{{ weather.icon }}"> {{ weather.desc }}</img>
    

    <h3> metrics</h3>
    {{ metrics }}
    <h3> unassigned_tasks</h3>
    {% for task in metrics['unassigned_tasks'] %}
    <a href="/view-post/{{ task.post_id }}">{{ task.desc }}</a><br>
    {% endfor %}

    <h3> Latest Sales</h3>
    ${{fake_sales}}


    <h3>Store Information</h3>
    {{ store_obj.name }}<br>
    {{ store_obj.address }}<br>
    {{ store_obj.phone }}<br>

    <h3>Employee List</h3>
    {% for employee in store_obj.employees|sort(attribute='pos_id') %}
    <a href='/view-profile/{{ employee.emp_id }}'>{{ employee.fname }} {{ employee.lname }}</a>, {{ employee.position.title }}<br>

    {% endfor %}

    <h3>Incomplete Tasks</h3>

    <h3>Unassigned Tasks</h3>

  </div></div><!--card--><!--card-body-->
</div><!--col-->





<script type="text/javascript">

function createBarGraph(url) {

  d3.json(url, function (results) {

    let data = results.data
    console.log(results)

    let width = 420;
    let barHeight = 50;

    let scale = d3.scale.linear()
      .domain([0, d3.max(data, (d) => d.max)])
      .range([0, width]);

    let color = d3.scale.linear()
      .domain([0, d3.max(data, (d) => d.max)])
      .range(['orange', 'steelblue']);

    let chart = d3.select(results.div)
      .attr("width", width)
      .attr("height", barHeight);

    let bar = chart.selectAll("g")
      .data(data)
      .enter().append("g")
      .attr("transform", function(d, i) { return "translate(0," + i * barHeight + ")"; });

    bar.append("rect")
      .attr('width', (d) => scale(d.value))
      .attr("height", barHeight - 1)
      .attr('fill', (d) => color(d.value));

    bar.append("text")
      .attr("x", function(d) { return scale(d.value) - 3; })
      .attr("y", barHeight / 2)
      .attr("dy", ".35em")
      .text(function(d) { return d.percent; });

  });
  };

createBarGraph('/store/{{ store_obj.store_id }}/task-completion.json');
createBarGraph('/view-profile/{{ store_obj.store_id }}/read-compliance.json')

</script>
{% endblock %}
                        