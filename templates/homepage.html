{% extends 'base.html' %}

{% block title %}Welcome to Storenet{% endblock %}

{% block body %}
<br>
<div class="row">

  <div class="col-xs-12 col-md-3 col-lg-3">
    <div class="card">
      <div class="card-body">
      <h3>Store Dashboard</h3>
      Store {{ session['store_id'] }} - {{ store.name }}<br><br>
      <b>Today's Sales Projections</b><br>
      $1500<br><br>
      <b>Current Weather for {{ weather.place }}</b><br>
      <img src="{{ weather.icon }}"> {{ weather.desc }}
      </div> <!--card-body-->
    </div> <!--card -->
  </div> <!--col-->

<div class="col-xs-12 col-md-6 col-lg-6">
  <div class='card'>
    <div class="card-body">

      <nav class="nav nav-tabs" id="myTab" role="tablist">
        <a class="nav-item nav-link active" id="nav-home-tab" data-toggle="tab" href="#nav-home" role="tab" aria-controls="nav-home" aria-selected="true"><h3>New Posts</h3></a>
        <a class="nav-item nav-link" id="nav-profile-tab" data-toggle="tab" href="#nav-profile" role="tab" aria-controls="nav-profile" aria-selected="false"><h3>Calendar</h3></a>
      </nav>
      <div class="tab-content" id="nav-tabContent">
        <div class="tab-pane fade show active" id="nav-home" role="tabpanel" aria-labelledby="nav-home-tab">
        <!-- NEW POSTS SECTION -->
        <br>
          {% if assigned_posts %}
            {% for assigned_post in assigned_posts %}
              {% if assigned_post.was_read == False %}
              <span class="badge badge-success">NEW</span>
              {% endif %}
            <a href='/posts/{{ assigned_post.post_id }}'>{{ assigned_post.post.title }}</a><br>
            <small>Posted on {{ assigned_post.post.date.strftime('%a, %m.%d.%y') }}
              {% if assigned_post.post.tasks %}
              | <a href="#" class="badge badge-secondary">Action Required</a>
              {% endif %}
            </small><br><br>
            {% endfor %}
          {% else %}
            There are no posts.
          {% endif %}
          <a href="#" class="btn btn-primary">View more posts</a>
        <!-- END NEW POSTS SECTION -->
        </div>
        <div class="tab-pane fade" id="nav-profile" role="tabpanel" aria-labelledby="nav-profile-tab">
          <!-- BEGIN CALENDAR -->
                <table border='1'>

                <tr>
                <td width='14%'>Sun</td>
                <td width='14%'>Mon</td>
                <td width='14%'>Tue</td>
                <td width='14%'>Wed</td>
                <td width='14%'>Thu</td>
                <td width='14%'>Fri</td>
                <td width='14%'>Sat</td>
                </tr>

                <tr>
                {% for day in calendar[0] %}
                <td width='14%'>{{ day[0].month }} {{ day[0].day }}<br>
                  {% if day[2] %}
                    {% for event in day[2] %}<br>
                    <small>{{ event.desc }}</small>
                    {% endfor %}
                  {% endif %}

                  {% if day[1] %}
                    {% for task_due in day[1] %}<br>
                    <small>Task due: {{ task_due.desc }}</small>
                    {% endfor %}
                  {% endif %}

                </td>
                {% endfor %}
                </tr>

                 <tr>
                {% for day in calendar[1] %}
                <td width='14%'>{{ day[0].month }} {{ day[0].day }}<br>
                  {% if day[2] %}
                    {% for event in day[2] %}<br>
                    <small>{{ event.desc }}</small>
                    {% endfor %}
                  {% endif %}

                  {% if day[1] %}
                    {% for task_due in day[1] %}<br>
                    <small>Task due: {{ task_due.desc }}</small>
                    {% endfor %}
                  {% endif %}

                </td>
                {% endfor %}
                </tr>
               

                </table>
          <!--end CALENDAR -->
        </div><!--tab pane -->
       </div>

              <!-- begin posts -->

    </div><!--card-body-->
  </div><!--card-->


  </div><!--col-->

  <div class="col-xs-12 col-md-3 col-lg-3">
    <div class="card">
      <div class="card-body">
      <!-- TASKS SECTION -->
      <h3>Task Manager</h3>
      {% if incomplete_tasks %}
      <h6 class="card-subtitle mb-2 text-muted">Incomplete Tasks 
      <span class="badge badge-pill badge-warning">{{ incomplete_tasks|length }}</span></h6>
        {% for task in incomplete_tasks %}
        <a href='posts/{{ task.post_id }}'>{{ task.desc }}</a><br>
        <small>due in <b>{{ (task.deadline - current_date) }}</b></small>
        {% endfor %}

      {% else %}
      Your store is up to date on all tasks.
      {% endif %}


      {% for task in metrics['unassigned_tasks'] %}
        {{ task.desc }}
      {% endfor %}

      <div id="content"></div>

      <!-- END TASK SECTION -->
      </div>
    </div>
  </div>
</div>

View post by category:
  {% for category in categories: %}
    <a href='/{{ category.cat_id }}'>{{ category.name }}</a> |
  {% endfor %}


<script type="text/javascript">
  'use strict';

function showWeather() {

    let url = '/posts/20171204015438/read-compliance.json';
    let formData = {"zipcode": $("#zipcode-field").val()};


    $.get(url, function (results) {
        console.log(results);
    });
}
showWeather()

  d3.json('/posts/20171204015438/read-compliance.json', function (data) {

let color = d3.scale.ordinal()
  .range(['orange', 'steelblue']);

var radius = 75;
var border = 5;
var padding = 30;
var startPercent = 0;
var endPercent = .5;

var formatPercent = d3.format('.0%');
var boxSize = (radius + padding) * 2;

var count = Math.abs((endPercent - startPercent) / 0.01);
var step = endPercent < startPercent ? -0.01 : 0.01;

var arc = d3.svg.arc()
    .startAngle(0)
    .innerRadius(radius)
    .outerRadius(radius - border);

var parent = d3.select('div#content');

var svg = parent.append('svg')
    .attr('width', boxSize)
    .attr('height', boxSize);

var defs = svg.append('defs');

var g = svg.append('g')
    .attr('transform', 'translate(' + boxSize / 2 + ',' + boxSize / 2 + ')');

var innerCircle = g.append('g')
    .attr('class', 'progress-meter');

innerCircle.append('path')
    .attr('class', 'background')
    .attr('fill', '#ccc')
    .attr('fill-opacity', 0.5)
    .attr('d', arc.endAngle(Math.PI * 2));

var foreground = innerCircle.append('path')
    .attr('class', 'foreground')
    .attr('fill', color)
    .attr('fill-opacity', 1)
    .attr('stroke', color)
    .attr('stroke-width', 5)
    .attr('stroke-opacity', 1);

var front = innerCircle.append('path')
    .attr('class', 'foreground')
    .attr('fill', color)
    .attr('fill-opacity', 1);

var numberText = innerCircle.append('text')
    .attr('fill', 'black')
    .attr('text-anchor', 'middle')
    .attr('dy', '.35em')

function updateProgress(progress) {
    foreground.attr('d', arc.endAngle(Math.PI * 2 * progress));
    front.attr('d', arc.endAngle(Math.PI * 2 * progress));
    numberText.text(formatPercent(progress));
}

var progress = startPercent;

(function loops() {
    updateProgress(progress);

    if (count > 0) {
        count--;
        progress += step;
        setTimeout(loops, 10);
    }
})()});

</script>

{% endblock %}